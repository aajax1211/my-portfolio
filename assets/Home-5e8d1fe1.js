import{M as e,V as t,U as o,b as s,u as n,T as a,d as r,e as i,D as c,f as u,S as p,g as l,h as f,i as h,k as d,a as g,l as m,j as b,F as w,m as k,O as x,E as M,L as y,C as S}from"./three-vendor-b8176658.js";import{r as j}from"./react-vendor-96e705e8.js";import{P as v,S as P,p as $,B as O,u as C,a as I,b as A,c as B,o as E,e as R,d as U,U as z}from"./index-4524f6a3.js";const F="#ffffff",L=[new e({color:F}),new e({color:F}),new e({color:F}),new e({color:F})];const T=Math.PI/180;$.forEach((e=>{try{n.preload(a,[`${O}textures/${e.front}.jpg`]),n.preload(a,[`${O}textures/${e.back}.jpg`]),n.preload(a,[`${O}textures/book-cover-roughness.jpg`])}catch(t){}}));const D=({number:n,front:a,back:m,page:b,opened:w,bookClosed:k,...x})=>{const[M,y]=j.useState(!1),[S,z]=C(I);r(M);const[F,D,W]=i([`${O}textures/${a}.jpg`,`${O}textures/${m}.jpg`,...0===n||n===$.length-1?[`${O}textures/book-cover-roughness.jpg`]:[]],void 0),G=j.useRef(),N=j.useRef(),V=j.useRef(0),q=j.useRef(w),H=new e({map:F,roughnessMap:0===n?W:null,side:c,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}),J=new e({map:D,roughnessMap:n===$.length-1?W:null,side:c,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}),{mesh:K,bones:Q,skeleton:X}=j.useMemo((()=>{const e=A.clone();!function(e){if(!e.attributes.position)return;e.translate(v/2,0,0);const n=e.attributes.position,a=new t,r=[],i=[];for(let t=0;t<n.count;t++){a.fromBufferAttribute(n,t);const e=a.x,o=Math.max(0,Math.floor(e/P)),s=e%P/P;r.push(o,o+1,0,0),i.push(1-s,s,0,0)}e.setAttribute("skinIndex",new o(r,4)),e.setAttribute("skinWeight",new s(i,4)),e.computeBoundingBox()}(e);const n=[];for(let t=0;t<=B;t++){const e=new u;e.position.x=0===t?0:P,t>0&&n[t-1].add(e),n.push(e)}const a=new p(n),r=[...L,H,J];F.colorSpace=D.colorSpace=l;const i=new f(e,r);return i.castShadow=!0,i.receiveShadow=!0,i.frustumCulled=!1,i.add(n[0]),i.bind(a),n[0].updateMatrixWorld(!0),{mesh:i,bones:n,skeleton:a}}),[]);h(((e,t)=>{if(!N.current)return;const o=N.current.skeleton.bones;q.current!==w&&(V.current=+new Date,q.current=w);let s=w?-Math.PI/2:Math.PI/2;k||(s+=.8*n*T);const a=o.map(((e,t)=>t<8?Math.sin(.2*t+.25):0)),r=o.map(((e,t)=>t>8?Math.cos(.3*t+.09):0));for(let n=0;n<o.length;n++){const e=0===n?G.current:o[n];let i=s*a[n]*.18-E*r[n]*s;k&&(i=0===n?s:0),Math.abs(e.rotation.y-i)>.001&&d.dampAngle(e.rotation,"y",i,R,t)}}));const Y=k?b.length+1:b;return g("group",{...x,ref:G,"rotation-y":0,"position-x":-n*U,onPointerEnter:e=>{e.stopPropagation(),y(!0)},onPointerLeave:e=>{e.stopPropagation(),y(!1)},onClick:e=>{e.stopPropagation(),n<5&&z(w?n:n+1),y(!1)},children:g("primitive",{ref:N,object:K,"position-z":-n*U+(n===Y?2*U:0),renderOrder:n===Y?1:0})})},W=({...e})=>{const[t]=C(I),[o,s]=j.useState(t);return j.useEffect((()=>{if(t===o)return;const e=Math.abs(t-o)>2?50:150,n=setTimeout((()=>{t>o?s((e=>e+1)):t<o&&s((e=>e-1))}),e);return()=>clearTimeout(n)}),[t,o]),g("group",{...e,children:$.map(((e,t)=>g(D,{number:t,front:e.front,back:e.back,page:o,opened:o>t,bookClosed:0===o||o===$.length,...e},t)))})},G=()=>{const[e]=C(I),t=0===e,{position:o}=m({position:t?[0,0,.5]:[0,0,0],config:{mass:.5,tension:120,friction:20}});return b(w,{children:[g(k.group,{position:o,children:g(W,{})}),g(x,{}),g(M,{preset:"studio"}),g("directionalLight",{position:[2,5,2],intensity:2.5,castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-bias":-1e-4}),b("mesh",{"position-y":-1.5,"rotation-x":-Math.PI/2,receiveShadow:!0,children:[g("planeGeometry",{args:[100,100]}),g("shadowMaterial",{transparent:!0,opacity:.2})]})]})};function N(){return b(w,{children:[g(z,{}),g(y,{}),g(S,{className:"absolute inset-0 w-full h-full",shadows:!0,camera:{position:[-.5,1,4],fov:45},children:g("group",{"position-y":0,children:g(j.Suspense,{fallback:null,children:g(G,{})})})})]})}export{N as default};
